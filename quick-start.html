<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Quick Start: Your First Extension - The Ruby on Rust Book</title>


        <!-- Custom HTML head -->

        <meta name="description" content="A comprehensive guide to building Ruby extensions with Rust using rb-sys">
        <meta name="keywords" content="ruby, rust, ffi, bindings, rb-sys, ruby on rust">
        <meta name="author" content="">
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="website">
        <meta property="og:url" content="">
        <meta property="og:title" content="Quick Start: Your First Extension - The Ruby on Rust Book">
        <meta property="og:description" content="A comprehensive guide to building Ruby extensions with Rust using rb-sys">
        
        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image">
        <meta property="twitter:url" content="">
        <meta property="twitter:title" content="Quick Start: Your First Extension - The Ruby on Rust Book">
        <meta property="twitter:description" content="A comprehensive guide to building Ruby extensions with Rust using rb-sys">
        
        <!-- Canonical URL -->
        <link rel="canonical" href="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/css/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Ruby on Rust Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/oxidize-rb/rb-sys" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="quick-start-your-first-extension"><a class="header" href="#quick-start-your-first-extension">Quick Start: Your First Extension</a></h1>
<p>This chapter shows you how to create a Ruby gem with a Rust extension using Bundler's built-in Rust support.</p>
<h2 id="creating-a-gem-with-bundler"><a class="header" href="#creating-a-gem-with-bundler">Creating a Gem with Bundler</a></h2>
<p>The easiest way to create a new gem with a Rust extension is with Bundler:</p>
<pre><code class="language-bash"># Create a new gem with a Rust extension
bundle gem --ext=rust hello_rusty
cd hello_rusty
</code></pre>
<p>This command generates everything you need to build a Ruby gem with a Rust extension.</p>
<h2 id="understanding-the-generated-files"><a class="header" href="#understanding-the-generated-files">Understanding the Generated Files</a></h2>
<p>Let's examine the key files Bundler created:</p>
<pre><code>hello_rusty/
├── ext/hello_rusty/          # Rust extension directory
│   ├── Cargo.toml            # Rust dependencies
│   ├── extconf.rb            # Ruby extension config
│   └── src/lib.rs            # Rust code
├── lib/hello_rusty.rb        # Main Ruby file
└── hello_rusty.gemspec       # Gem specification
</code></pre>
<h3 id="the-rust-code-librs"><a class="header" href="#the-rust-code-librs">The Rust Code (lib.rs)</a></h3>
<p>Bundler generates a simple "Hello World" implementation:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span><span class="boring">// ext/hello_rusty/src/lib.rs
</span>use magnus::{define_module, function, prelude::*, Error};

#[magnus::init]
fn init() -&gt; Result&lt;(), Error&gt; {
    let module = define_module("HelloRusty")?;
    module.define_singleton_method("hello", function!(|| "Hello from Rust!", 0))?;
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<div class="note">
<p>You can click the "play" button on code blocks to try them out in the Rust Playground where appropriate. For code that
depends on the Ruby API, you won't be able to run it directly, but you can experiment with Rust syntax and standard
library functions.</p>
</div>
<h3 id="the-extension-configuration-extconfrb"><a class="header" href="#the-extension-configuration-extconfrb">The Extension Configuration (extconf.rb)</a></h3>
<pre><code class="language-ruby"># ext/hello_rusty/extconf.rb
require "mkmf"
require "rb_sys/mkmf"

create_rust_makefile("hello_rusty/hello_rusty")
</code></pre>
<p>This file connects Ruby's build system to Cargo.</p>
<h2 id="enhancing-the-default-implementation"><a class="header" href="#enhancing-the-default-implementation">Enhancing the Default Implementation</a></h2>
<p>Let's improve the default implementation by adding a simple class:</p>
<pre><code class="language-rust noplayground hidelines=#"><span class="boring">// This is our enhanced implementation
</span>use magnus::{define_module, define_class, function, method, prelude::*, Error, Ruby};

// Define a struct to hold state and
// implement Ruby wrapper for the struct
#[magnus::wrap(class = "HelloRusty::Greeter")]
struct Greeter {
    name: String,
}

impl Greeter {
    // Constructor
    fn new(name: String) -&gt; Self {
        Greeter { name }
    }

    // Instance method
    fn greet(&amp;self) -&gt; String {
        format!("Hello, {}!", self.name)
    }
}

<span class="boring">// Let's also add a method that takes a parameter
</span><span class="boring">impl Greeter {
</span><span class="boring">    fn greet_with_prefix(&amp;self, prefix: String) -&gt; String {
</span><span class="boring">        format!("{} Hello, {}!", prefix, self.name)
</span><span class="boring">    }
</span><span class="boring">}
</span>
// Module initialization function
#[magnus::init]
fn init(ruby: &amp;Ruby) -&gt; Result&lt;(), Error&gt; {
    let module = ruby.define_module("HelloRusty")?;

    // Define and configure the Greeter class
    let class = module.define_class("Greeter", ruby.class_object())?;
    class.define_singleton_method("new", function!(Greeter::new, 1))?;
    class.define_method("greet", method!(Greeter::greet, 0))?;

<span class="boring">    // We could also expose the additional method
</span><span class="boring">    // class.define_method("greet_with_prefix", method!(Greeter::greet_with_prefix, 1))?;
</span>
    Ok(())
}</code></pre>
<div class="tip">
<p>Click the eye icon (<i class="fa fa-eye"></i>) to reveal commented lines with additional functionality that you could
add to your implementation.</p>
</div>
<h2 id="building-and-testing"><a class="header" href="#building-and-testing">Building and Testing</a></h2>
<h3 id="compile-the-extension"><a class="header" href="#compile-the-extension">Compile the Extension</a></h3>
<pre><code class="language-bash"># Install dependencies and compile
bundle install
bundle exec rake compile
</code></pre>
<p>What happens during compilation:</p>
<ol>
<li>Ruby's <code>mkmf</code> reads your <code>extconf.rb</code></li>
<li><code>create_rust_makefile</code> generates a Makefile with Cargo commands</li>
<li>Cargo compiles your Rust code to a dynamic library</li>
<li>The binary is copied to <code>lib/hello_rusty/hello_rusty.{so,bundle,dll}</code></li>
</ol>
<h3 id="run-the-tests"><a class="header" href="#run-the-tests">Run the Tests</a></h3>
<p>Bundler generates a basic test file. Let's update it:</p>
<pre><code class="language-ruby hidelines=#"><span class="boring"> test/test_hello_rusty.rb
</span>require "test_helper"

class TestHelloRusty &lt; Minitest::Test
  def test_that_it_has_a_version_number
    refute_nil ::HelloRusty::VERSION
  end

  def test_greeter
    greeter = HelloRusty::Greeter.new("Rustacean")
    assert_equal "Hello, Rustacean!", greeter.greet
  end

<span class="boring">   # If we implemented the additional method, we could test it
</span><span class="boring">   def test_greeter_with_prefix
</span><span class="boring">     greeter = HelloRusty::Greeter.new("Rustacean")
</span><span class="boring">     assert_equal "Howdy! Hello, Rustacean!", greeter.greet_with_prefix("Howdy!")
</span><span class="boring">   end
</span>end
</code></pre>
<p>Run the tests:</p>
<pre><code class="language-bash hidelines=#"><span class="boring"> Run the standard test suite
</span>bundle exec rake test

<span class="boring"> You can also run specific tests
</span><span class="boring"> bundle exec ruby -Ilib:test test/test_hello_rusty.rb -n test_greeter
</span></code></pre>
<h3 id="try-it-in-the-console"><a class="header" href="#try-it-in-the-console">Try It in the Console</a></h3>
<pre><code class="language-bash hidelines=#"><span class="boring"> Start the console
</span>bundle exec bin/console

<span class="boring"> You can also use irb directly
</span><span class="boring"> bundle exec irb -Ilib -rhello_rusty
</span></code></pre>
<p>Once in the console, you can interact with your extension:</p>
<pre><code class="language-ruby hidelines=#"><span class="boring"> Create a new greeter object
</span>greeter = HelloRusty::Greeter.new("World")

<span class="boring"> Call the greet method
</span>puts greeter.greet  # =&gt; "Hello, World!"

<span class="boring"> # If you added the additional method, you could call it
</span><span class="boring"> puts greeter.greet_with_prefix("Howdy!")  # =&gt; "Howdy! Hello, World!"
</span></code></pre>
<h2 id="customizing-the-build"><a class="header" href="#customizing-the-build">Customizing the Build</a></h2>
<p>You can customize the build process with environment variables:</p>
<pre><code class="language-bash hidelines=#"><span class="boring"> Release build (optimized)
</span>RB_SYS_CARGO_PROFILE=release bundle exec rake compile

<span class="boring"> With specific Cargo features
</span>RB_SYS_CARGO_FEATURES=feature1,feature2 bundle exec rake compile

<span class="boring"> You can also combine variables
</span><span class="boring"> RB_SYS_CARGO_PROFILE=release RB_SYS_CARGO_FEATURES=feature1 bundle exec rake compile
</span>
<span class="boring"> For more verbose output
</span><span class="boring"> RB_SYS_CARGO_VERBOSE=1 bundle exec rake compile
</span></code></pre>
<div class="warning">
<p>Remember that building in release mode will produce optimized, faster code but will increase compilation time.</p>
</div>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>Congratulations! You've created a Ruby gem with a Rust extension. In the next chapters, we'll explore:</p>
<ul>
<li>Better project organization</li>
<li>Working with Ruby objects in Rust</li>
<li>Memory management and safety</li>
<li>Performance optimization</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" style="margin-bottom: 0;" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="getting-started.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="project-setup.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                    
                    <div class="footer-note" style="margin: 3rem 0 0 0; padding: 2rem; font-size: 1.1rem; color: #555; border-top: 1px solid #ddd; display: flex; justify-content: center; align-items: center; font-family: inherit;">
                        <div style="max-width: 800px; text-align: center; line-height: 1.6;">
                            This documentation was created with assistance from an LLM.<br>
                            If you spot any issues, please <a href="https://github.com/oxidize-rb/rb-sys/issues" style="color: #3184a8; text-decoration: none; font-weight: bold;">submit a fix or report it</a>.<br>
                            We appreciate your help in improving these docs!
                        </div>
                    </div>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="getting-started.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="project-setup.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/js/custom.js"></script>


    </div>
    </body>
</html>
