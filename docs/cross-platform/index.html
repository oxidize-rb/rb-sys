<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cross-platform" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Cross-Platform Development | oxidize.rb</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://oxidize-rb.org/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://oxidize-rb.org/img/social-card.png"><meta data-rh="true" property="og:url" content="https://oxidize-rb.org/docs/cross-platform"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" name="twitter:site" content="@oxidize_rb"><meta data-rh="true" property="og:type" content="website"><meta data-rh="true" property="og:locale" content="en_US"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cross-Platform Development | oxidize.rb"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://oxidize-rb.org/docs/cross-platform"><link data-rh="true" rel="alternate" href="https://oxidize-rb.org/docs/cross-platform" hreflang="en"><link data-rh="true" rel="alternate" href="https://oxidize-rb.org/docs/cross-platform" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Cross-Platform Development","item":"https://oxidize-rb.org/docs/cross-platform"}]}</script><meta name="keywords" content="ruby, rust, extensions, ffi, rb-sys, oxidize, native extensions, ruby gems">
<meta name="description" content="Build high-performance Ruby extensions with Rust using rb-sys. The easiest way to create native Ruby gems with memory safety and performance.">
<meta name="robots" content="index, follow">
<meta name="author" content="oxidize-rb">
<link rel="canonical" href="https://oxidize-rb.org"><link rel="stylesheet" href="/assets/css/styles.f4b239a4.css">
<script src="/assets/js/runtime~main.9b6ed74c.js" defer="defer"></script>
<script src="/assets/js/main.086c2967.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo-oxidize-rb.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" aria-label="oxidize.rb home page" href="/"><img src="/img/logo-oxidize-rb.svg" alt="oxidize.rb Logo" width="32" height="32"><span class="navbar__title">oxidize.rb</span></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oxidize-rb/rb-sys" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></div></div></nav><div class="main-wrapper mainWrapper_eExm"><main class="mainContent_VsED"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Ruby &amp; Rust</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/getting-started">üöÄ Getting Started</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Getting Started</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/quick-start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts">Core Concepts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/project-setup">üî® Building Extensions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/memory-management">üß† Memory &amp; Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/examples">üåç Real-World Patterns</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/testing">üßë‚Äçüíª Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/cross-platform">üì¶ Deployment</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/cross-platform">Cross-Platform Development</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api-reference/rb-sys-features">üìñ Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/cookbook">Resources</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">üì¶ Deployment</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Cross-Platform Development</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Cross-Platform Development</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">‚Äã</a></h2>
<p>One of rb-sys&#x27;s greatest strengths is its support for cross-platform Ruby extensions. This chapter covers how to
develop, test, and distribute extensions across multiple platforms.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="supported-platforms">Supported Platforms<a href="#supported-platforms" class="hash-link" aria-label="Direct link to Supported Platforms" title="Direct link to Supported Platforms">‚Äã</a></h2>
<p>rb-sys supports cross-compilation to the following platforms:</p>
<table><thead><tr><th>Platform</th><th>Supported</th><th>Docker Image</th></tr></thead><tbody><tr><td>x86_64-linux</td><td>‚úÖ</td><td><code>rbsys/x86_64-linux</code></td></tr><tr><td>x86_64-linux-musl</td><td>‚úÖ</td><td><code>rbsys/x86_64-linux-musl</code></td></tr><tr><td>aarch64-linux</td><td>‚úÖ</td><td><code>rbsys/aarch64-linux</code></td></tr><tr><td>aarch64-linux-musl</td><td>‚úÖ</td><td><code>rbsys/aarch64-linux-musl</code></td></tr><tr><td>arm-linux</td><td>‚úÖ</td><td><code>rbsys/arm-linux</code></td></tr><tr><td>arm64-darwin</td><td>‚úÖ</td><td><code>rbsys/arm64-darwin</code></td></tr><tr><td>x64-mingw32</td><td>‚úÖ</td><td><code>rbsys/x64-mingw32</code></td></tr><tr><td>x64-mingw-ucrt</td><td>‚úÖ</td><td><code>rbsys/x64-mingw-ucrt</code></td></tr><tr><td>mswin</td><td>‚úÖ</td><td>not available on Docker</td></tr><tr><td>truffleruby</td><td>‚úÖ</td><td>not available on Docker</td></tr></tbody></table>
<p>The Docker images are available on <a href="https://hub.docker.com/r/rbsys/rcd" target="_blank" rel="noopener noreferrer">Docker Hub</a> and are automatically updated with
each rb-sys release.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="platform-considerations">Platform Considerations<a href="#platform-considerations" class="hash-link" aria-label="Direct link to Platform Considerations" title="Direct link to Platform Considerations">‚Äã</a></h2>
<p>Ruby extensions face several cross-platform challenges:</p>
<ul>
<li>Different operating systems (Linux, macOS, Windows)</li>
<li>Different CPU architectures (x86_64, ARM64)</li>
<li>Different Ruby implementations</li>
<li>Different compilers and linkers</li>
<li>System libraries and dependencies</li>
</ul>
<p>rb-sys provides tools to handle these differences effectively.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-platform-targets">Understanding Platform Targets<a href="#understanding-platform-targets" class="hash-link" aria-label="Direct link to Understanding Platform Targets" title="Direct link to Understanding Platform Targets">‚Äã</a></h2>
<p>Ruby identifies platforms with standardized strings:</p>
<table><thead><tr><th>Platform String</th><th>Description</th></tr></thead><tbody><tr><td><code>x86_64-linux</code></td><td>64-bit Linux on Intel/AMD</td></tr><tr><td><code>aarch64-linux</code></td><td>64-bit Linux on ARM</td></tr><tr><td><code>x86_64-darwin</code></td><td>64-bit macOS on Intel</td></tr><tr><td><code>arm64-darwin</code></td><td>64-bit macOS on Apple Silicon</td></tr><tr><td><code>x64-mingw-ucrt</code></td><td>64-bit Windows (UCRT)</td></tr><tr><td><code>x64-mingw32</code></td><td>64-bit Windows (older)</td></tr></tbody></table>
<p>These platform strings are used by:</p>
<ul>
<li>RubyGems to select the correct pre-built binary</li>
<li>rake-compiler for cross-compilation</li>
<li>rb-sys-dock to build for different platforms</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="conditional-compilation">Conditional Compilation<a href="#conditional-compilation" class="hash-link" aria-label="Direct link to Conditional Compilation" title="Direct link to Conditional Compilation">‚Äã</a></h2>
<p>Rust&#x27;s conditional compilation features allow you to write platform-specific code:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Platform-specific code</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">platform_specific</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Windows-specific implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;macos&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">platform_specific</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// macOS-specific implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;linux&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">platform_specific</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Linux-specific implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<p>For architectures:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_arch = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;x86_64&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">arch_specific</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// x86_64 implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_arch = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;aarch64&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">arch_specific</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// ARM64 implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-example-file-path-handling">Complete Example: File Path Handling<a href="#complete-example-file-path-handling" class="hash-link" aria-label="Direct link to Complete Example: File Path Handling" title="Direct link to Complete Example: File Path Handling">‚Äã</a></h3>
<p>Here&#x27;s a real-world example of handling paths differently across platforms:</p>
<div class="languageCallout_VNpC rust_PB7z"><div class="header_itAP"><div class="icon_vHP_"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" height="20" width="20"><circle cx="12" cy="12" r="8"></circle><path d="M12 4v2M12 18v2M4 12H6M18 12h2M6.34 6.34l1.42 1.42M16.24 16.24l1.42 1.42M6.34 17.66l1.42-1.42M16.24 7.76l1.42-1.42"></path><path d="M9 12a3 3 0 1 0 6 0 3 3 0 0 0-6 0z"></path></svg></div><div class="title_Bire">Platform-Specific Path Handling</div></div><div class="content_ZrzH"><div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">path</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">get_config_path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">PathBuf</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> path </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">profile</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">var_os</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;USERPROFILE&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">profile</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;AppData&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Roaming&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;MyApp&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;config.toml&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        path</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;macos&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> path </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">home</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">var_os</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;HOME&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">home</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Library&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Application Support&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;MyApp&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;config.toml&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        path</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;linux&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> path </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">config_dir</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">var_os</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;XDG_CONFIG_HOME&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">config_dir</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">else</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">home</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">var_os</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;HOME&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">home</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;.config&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;myapp&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;config.toml&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        path</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(not(any(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;macos&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;linux&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Default for other platforms</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">PathBuf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;config.toml&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="platform-specific-dependencies">Platform-Specific Dependencies<a href="#platform-specific-dependencies" class="hash-link" aria-label="Direct link to Platform-Specific Dependencies" title="Direct link to Platform-Specific Dependencies">‚Äã</a></h2>
<p>Cargo.toml supports platform-specific dependencies:</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">[dependencies]</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"># Common dependencies...</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">[target.&#x27;cfg(target_os = &quot;windows&quot;)&#x27;.dependencies]</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">winapi = { version = &quot;0.3&quot;, features = [&quot;winbase&quot;] }</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">[target.&#x27;cfg(target_os = &quot;macos&quot;)&#x27;.dependencies]</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">core-foundation = &quot;0.9&quot;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-buildrs-for-platform-detection">Using build.rs for Platform Detection<a href="#using-buildrs-for-platform-detection" class="hash-link" aria-label="Direct link to Using build.rs for Platform Detection" title="Direct link to Using build.rs for Platform Detection">‚Äã</a></h2>
<p>The Rust build script (<code>build.rs</code>) can be used to detect platforms and configure builds:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// ext/my_gem/build.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">main</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Detect OS</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> target </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">env</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">var</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;TARGET&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap_or_default</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> target</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">contains</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-link-lib=dylib=user32&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-cfg=feature=\&quot;windows_specific\&quot;&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">else</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> target</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">contains</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-link-lib=framework=CoreFoundation&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-cfg=feature=\&quot;macos_specific\&quot;&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">else</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> target</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">contains</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;linux&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-link-lib=dylib=dl&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-cfg=feature=\&quot;linux_specific\&quot;&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Tell Cargo to invalidate the built crate whenever the build script changes</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rerun-if-changed=build.rs&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<p>Then in your code:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Note: These features would need to be defined in your Cargo.toml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(feature = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows_specific&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">platform_init</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Windows initialization code</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(feature = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;macos_specific&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">platform_init</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// macOS initialization code</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(feature = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;linux_specific&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">platform_init</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Linux initialization code</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cross-compilation-with-rb-sys-dock">Cross-Compilation with rb-sys-dock<a href="#cross-compilation-with-rb-sys-dock" class="hash-link" aria-label="Direct link to Cross-Compilation with rb-sys-dock" title="Direct link to Cross-Compilation with rb-sys-dock">‚Äã</a></h2>
<p>rb-sys-dock is a Docker-based tool that simplifies cross-compilation:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-rb-sys-dock-in-your-gem">Setting Up rb-sys-dock in Your Gem<a href="#setting-up-rb-sys-dock-in-your-gem" class="hash-link" aria-label="Direct link to Setting Up rb-sys-dock in Your Gem" title="Direct link to Setting Up rb-sys-dock in Your Gem">‚Äã</a></h3>
<ol>
<li>Add rb-sys-dock to your Gemfile:</li>
</ol>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Gemfile</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">group </span><span class="token symbol" style="color:hsl(5, 65%, 75%)">:development</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  gem </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;rb-sys-dock&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;~&gt; 0.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">end</span><br></span></code></pre></div></div>
<ol start="2">
<li>Configure your Rakefile for cross-compilation:</li>
</ol>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Rakefile</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">require</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;rb_sys/extensiontask&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token constant" style="color:hsl(5, 65%, 75%)">GEMSPEC</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> Gem</span><span class="token double-colon punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token plain">Specification</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">load</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;my_gem.gemspec&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">RbSys</span><span class="token double-colon punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">ExtensionTask</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;my_gem&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">GEMSPEC</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">do</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain">ext</span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">lib_dir </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;lib/my_gem&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">cross_compile </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(5, 65%, 75%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">cross_platform </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-linux&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;aarch64-linux&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;arm64-darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;x64-mingw-ucrt&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">end</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-for-a-specific-platform">Building for a Specific Platform<a href="#building-for-a-specific-platform" class="hash-link" aria-label="Direct link to Building for a Specific Platform" title="Direct link to Building for a Specific Platform">‚Äã</a></h3>
<p>To build for a specific platform:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rake native:my_gem:x86_64-linux</span><br></span></code></pre></div></div>
<p>This creates a platform-specific gem in the <code>pkg</code> directory.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="building-for-all-platforms">Building for All Platforms<a href="#building-for-all-platforms" class="hash-link" aria-label="Direct link to Building for All Platforms" title="Direct link to Building for All Platforms">‚Äã</a></h3>
<p>To build for all configured platforms:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rake native</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-rb-sys-dock-directly">Using rb-sys-dock Directly<a href="#using-rb-sys-dock-directly" class="hash-link" aria-label="Direct link to Using rb-sys-dock Directly" title="Direct link to Using rb-sys-dock Directly">‚Äã</a></h3>
<p>For more control, use rb-sys-dock directly:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Build for a specific platform</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rb-sys-dock </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">--platform</span><span class="token plain"> x86_64-linux </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">--build</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Start a shell in the Docker container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rb-sys-dock </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">--platform</span><span class="token plain"> x86_64-linux </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">--shell</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-cross-platform-builds">Testing Cross-Platform Builds<a href="#testing-cross-platform-builds" class="hash-link" aria-label="Direct link to Testing Cross-Platform Builds" title="Direct link to Testing Cross-Platform Builds">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-testing-with-docker">Local Testing with Docker<a href="#local-testing-with-docker" class="hash-link" aria-label="Direct link to Local Testing with Docker" title="Direct link to Local Testing with Docker">‚Äã</a></h3>
<p>You can test your cross-compiled Linux extensions locally:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Run tests inside a Docker container</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rb-sys-dock </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">--platform</span><span class="token plain"> x86_64-linux </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">--command</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;bundle exec rake test&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="local-testing-on-macos">Local Testing on macOS<a href="#local-testing-on-macos" class="hash-link" aria-label="Direct link to Local Testing on macOS" title="Direct link to Local Testing on macOS">‚Äã</a></h3>
<p>If you&#x27;re on macOS with Apple Silicon, you can test both architectures:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Test arm64-darwin build (native)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rake </span><span class="token builtin class-name">test</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Test x86_64-darwin build (cross-compiled)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">arch </span><span class="token parameter variable" style="color:hsl(5, 65%, 75%)">-x86_64</span><span class="token plain"> bundle </span><span class="token builtin class-name">exec</span><span class="token plain"> rake </span><span class="token builtin class-name">test</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cicd-for-multiple-platforms">CI/CD for Multiple Platforms<a href="#cicd-for-multiple-platforms" class="hash-link" aria-label="Direct link to CI/CD for Multiple Platforms" title="Direct link to CI/CD for Multiple Platforms">‚Äã</a></h2>
<p>GitHub Actions is ideal for testing across platforms:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testing-on-multiple-platforms">Testing on Multiple Platforms<a href="#testing-on-multiple-platforms" class="hash-link" aria-label="Direct link to Testing on Multiple Platforms" title="Direct link to Testing on Multiple Platforms">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># .github/workflows/test.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> Test</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">branches</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">pull_request</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">branches</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token plain">main</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">jobs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">test</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">strategy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">fail-fast</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(5, 65%, 75%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">matrix</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">os</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token plain">ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> macos</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> windows</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.0&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.1&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.2&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.3&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.os </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> oxidize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rb/actions/setup</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">and</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rust@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby-version</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.ruby </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">bundler-cache</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(5, 65%, 75%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> bundle exec rake compile</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> bundle exec rake test</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ruby-head-compatibility">Ruby-Head Compatibility<a href="#ruby-head-compatibility" class="hash-link" aria-label="Direct link to Ruby-Head Compatibility" title="Direct link to Ruby-Head Compatibility">‚Äã</a></h3>
<p>When supporting <code>ruby-head</code> or development versions of Ruby, you must publish a source gem alongside your precompiled gems. This is necessary because:</p>
<ol>
<li>The Ruby ABI (Application Binary Interface) can change between development versions</li>
<li>Precompiled binary gems built against one ruby-head version may be incompatible with newer ruby-head versions</li>
<li>Source gems allow users to compile the extension against their specific ruby-head version</li>
</ol>
<p>To ensure compatibility, add a source gem to your release process:</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Rakefile</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">RbSys</span><span class="token double-colon punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">ExtensionTask</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;my_gem&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">GEMSPEC</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">do</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain">ext</span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Configure cross-platform gems as usual</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">cross_compile </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token boolean" style="color:hsl(5, 65%, 75%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">cross_platform </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&#x27;x86_64-linux&#x27;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&#x27;arm64-darwin&#x27;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># The default platform will build the source gem</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">end</span><br></span></code></pre></div></div>
<p>Then in your CI/CD pipeline, include both platform-specific and source gem builds:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># .github/workflows/release.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">jobs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># First build all platform-specific gems</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">cross_compile</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Then build the source gem</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">source_gem</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ruby/setup</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby-version</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> bundle install</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> bundle exec rake build </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Builds the source gem</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/upload</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">artifact@v3</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> source</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">gem</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> pkg/</span><span class="token important">*.gem</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Include source gem without platform suffix</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cross-compiling-for-release">Cross-Compiling for Release<a href="#cross-compiling-for-release" class="hash-link" aria-label="Direct link to Cross-Compiling for Release" title="Direct link to Cross-Compiling for Release">‚Äã</a></h3>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># .github/workflows/release.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> Release</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">tags</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;v*&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">jobs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">cross_compile</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">strategy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">fail-fast</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(5, 65%, 75%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">matrix</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">platform</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-linux&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;aarch64-linux&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;arm64-darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;x64-mingw-ucrt&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ruby/setup</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby-version</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> oxidize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rb/actions/cross</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">gem@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">platform</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.platform </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/upload</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">artifact@v3</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> gem</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">$</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.platform </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> pkg/</span><span class="token important">*-$</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.platform </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain">.gem</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-ci-workflow-example">Complete CI Workflow Example<a href="#complete-ci-workflow-example" class="hash-link" aria-label="Direct link to Complete CI Workflow Example" title="Direct link to Complete CI Workflow Example">‚Äã</a></h3>
<p>Here&#x27;s a more complete workflow showing an automated release process with tests and cross-compilation:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># .github/workflows/gem-release.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> Gem Release</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">tags</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;v*&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">jobs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">fetch-data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">outputs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">platforms</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> steps.fetch.outputs.supported</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">platforms </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">id</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> fetch</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> oxidize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rb/actions/fetch</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ci</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">data@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">supported-ruby-platforms</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token scalar string" style="color:hsl(28, 60%, 70%)"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">            exclude: [x86-linux, x86-darwin, arm-linux]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">test</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">needs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> fetch</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">strategy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">fail-fast</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(5, 65%, 75%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">matrix</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">os</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token plain">ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> macos</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> windows</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.0&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.1&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.2&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.3&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.os </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> oxidize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rb/actions/setup</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">and</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rust@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby-version</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.ruby </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">bundler-cache</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(5, 65%, 75%)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> bundle exec rake compile</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> bundle exec rake test</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">cross-compile</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">needs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token plain">fetch</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> test</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">strategy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">fail-fast</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token boolean important" style="color:hsl(5, 65%, 75%)">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">matrix</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">platform</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> fromJSON(needs.fetch</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">data.outputs.platforms) </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ruby/setup</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby-version</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> oxidize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">rb/actions/cross</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">gem@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">platform</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.platform </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/upload</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">artifact@v3</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> gem</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">$</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.platform </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> pkg/</span><span class="token important">*-$</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.platform </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain">.gem</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">release</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">needs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> cross</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">compile</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">runs-on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">steps</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> ruby/setup</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">ruby@v1</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">ruby-version</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;3.1&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">uses</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> actions/download</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain">artifact@v3</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">with</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> artifacts</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> Move gems to pkg directory</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token scalar string" style="color:hsl(28, 60%, 70%)"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">          mkdir -p pkg</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">          find artifacts -name &quot;*.gem&quot; -exec mv {} pkg/ \;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> Publish to RubyGems</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">run</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token scalar string" style="color:hsl(28, 60%, 70%)"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">          mkdir -p ~/.gem</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">          echo -e &quot;---\n:rubygems_api_key: ${RUBYGEMS_API_KEY}&quot; &gt; ~/.gem/credentials</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">          chmod 0600 ~/.gem/credentials</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token scalar string" style="color:hsl(28, 60%, 70%)">          gem push pkg/*.gem</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">env</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">          </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">RUBYGEMS_API_KEY</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> secrets.RUBYGEMS_API_KEY </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="platform-specific-issues-and-solutions">Platform-Specific Issues and Solutions<a href="#platform-specific-issues-and-solutions" class="hash-link" aria-label="Direct link to Platform-Specific Issues and Solutions" title="Direct link to Platform-Specific Issues and Solutions">‚Äã</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="windows">Windows<a href="#windows" class="hash-link" aria-label="Direct link to Windows" title="Direct link to Windows">‚Äã</a></h3>
<p>Windows presents unique challenges for Ruby extensions:</p>
<ul>
<li>
<p><strong>Path Handling</strong>: Use forward slashes (<code>/</code>) in paths, not backslashes (<code>\</code>)</p>
</li>
<li>
<p><strong>DLL Loading</strong>: Handle DLL loading carefully</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">load_library</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">str</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">os</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">windows</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">ffi</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">OsStrExt</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">ffi</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">OsStr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">winapi</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">um</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">libloaderapi</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">LoadLibraryW</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> name_wide</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u16</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">OsStr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">encode_wide</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">chain</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">iter</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">once</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token number" style="color:hsl(5, 65%, 75%)">0</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">collect</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> handle </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> </span><span class="token class-name">LoadLibraryW</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">name_wide</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_ptr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> handle</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">is_null</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">return</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Failed to load library&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Asynchronous I/O</strong>: Windows has different async I/O APIs</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">#[cfg(target_os = &quot;windows&quot;)]</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">use windows_specific_io::read_file;</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">#[cfg(not(target_os = &quot;windows&quot;))]</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">use posix_specific_io::read_file;</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="macos">macOS<a href="#macos" class="hash-link" aria-label="Direct link to macOS" title="Direct link to macOS">‚Äã</a></h3>
<ul>
<li>
<p><strong>Architectures</strong>: Support both Intel and Apple Silicon</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Rakefile</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">RbSys</span><span class="token double-colon punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">ExtensionTask</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;my_gem&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">GEMSPEC</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">do</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain">ext</span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">cross_platform </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;arm64-darwin&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">end</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Framework Linking</strong>: Link against macOS frameworks</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// build.rs</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">main</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;macos&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-link-lib=framework=Security&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">println!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;cargo:rustc-link-lib=framework=CoreFoundation&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Universal Binary</strong>: Consider building universal binaries</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># extconf.rb</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">RUBY_PLATFORM</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=~</span><span class="token plain"> </span><span class="token regex-literal regex" style="color:hsl(5, 65%, 75%)">/darwin/</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token constant" style="color:hsl(5, 65%, 75%)">ENV</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&#x27;RUSTFLAGS&#x27;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;-C link-arg=-arch -C link-arg=arm64 -C link-arg=-arch -C link-arg=x86_64&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">end</span><br></span></code></pre></div></div>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux">Linux<a href="#linux" class="hash-link" aria-label="Direct link to Linux" title="Direct link to Linux">‚Äã</a></h3>
<ul>
<li>
<p><strong>glibc vs musl</strong>: Consider both glibc and musl for maximum compatibility</p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># Rakefile</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">RbSys</span><span class="token double-colon punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">ExtensionTask</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;my_gem&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">GEMSPEC</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">do</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain">ext</span><span class="token operator" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  ext</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">cross_platform </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-linux&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;x86_64-linux-musl&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">end</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Static Linking</strong>: Increase portability with static linking</p>
<div class="language-toml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-toml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"># Cargo.toml</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">[target.&#x27;cfg(target_os = &quot;linux&quot;)&#x27;.dependencies]</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">openssl-sys = { version = &quot;0.9&quot;, features = [&quot;vendored&quot;] }</span><br></span></code></pre></div></div>
</li>
<li>
<p><strong>Multiple Distributions</strong>: Test on different distributions in CI</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># .github/workflows/linux-test.yml</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">jobs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">  </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">test</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">strategy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">      </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">matrix</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">container</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;ubuntu:20.04&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;debian:bullseye&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;alpine:3.15&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token key atrule" style="color:hsl(200, 85%, 70%)">container</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> matrix.container </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="best-practices">Best Practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best Practices" title="Direct link to Best Practices">‚Äã</a></h2>
<ol>
<li><strong>Start with cross-compilation early</strong> - Don&#x27;t wait until release time</li>
<li><strong>Test on all target platforms</strong> - Ideally in CI</li>
<li><strong>Use platform-specific code sparingly</strong> - Abstract platform differences when possible</li>
<li><strong>Prefer conditional compilation over runtime checks</strong> - Better performance and safer code</li>
<li><strong>Document platform requirements</strong> - Make dependencies clear to users</li>
<li><strong>Use feature flags for optional platform support</strong> - Allow users to opt-in to platform-specific features</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-good-platform-abstraction">Example: Good Platform Abstraction<a href="#example-good-platform-abstraction" class="hash-link" aria-label="Direct link to Example: Good Platform Abstraction" title="Direct link to Example: Good Platform Abstraction">‚Äã</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">io</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Platform abstraction module</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">platform</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">io</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Define platform-specific handle types</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">type</span><span class="token plain"> </span><span class="token type-definition class-name">PlatformSpecificHandle</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">os</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">windows</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">RawHandle</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(unix)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">type</span><span class="token plain"> </span><span class="token type-definition class-name">PlatformSpecificHandle</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">os</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">unix</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">RawFd</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(not(any(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, unix)))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">type</span><span class="token plain"> </span><span class="token type-definition class-name">PlatformSpecificHandle</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">struct</span><span class="token plain"> </span><span class="token type-definition class-name">FileHandle</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">PlatformSpecificHandle</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">impl</span><span class="token plain"> </span><span class="token class-name">FileHandle</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">open</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">str</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">Self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Windows-specific implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">unimplemented!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(unix)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Unix-based implementation (Linux, macOS, etc.)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">unimplemented!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(not(any(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;windows&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, unix)))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">return</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">ErrorKind</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Other</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Unsupported platform&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">read</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u8</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Platform-specific reading implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">unimplemented!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">write</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> buf</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">[</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u8</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">]</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Platform-specific writing implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">unimplemented!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// User code just uses the abstraction</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">platform</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">FileHandle</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">process_file</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">str</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> file </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">FileHandle</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">open</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Common code without platform-specific details</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="complete-example-cross-platform-release-workflow">Complete Example: Cross-Platform Release Workflow<a href="#complete-example-cross-platform-release-workflow" class="hash-link" aria-label="Direct link to Complete Example: Cross-Platform Release Workflow" title="Direct link to Complete Example: Cross-Platform Release Workflow">‚Äã</a></h2>
<p>Here&#x27;s a complete example for releasing a cross-platform gem:</p>
<ol>
<li><strong>Develop locally</strong> on your preferred platform</li>
<li><strong>Test your changes</strong> locally with <code>bundle exec rake test</code></li>
<li><strong>Verify cross-platform builds</strong> with
<code>bundle exec rb-sys-dock --platform x86_64-linux --command &quot;bundle exec rake test&quot;</code></li>
<li><strong>Commit and push</strong> your changes</li>
<li><strong>CI tests</strong> run on all supported platforms</li>
<li><strong>Create a release tag</strong> when ready (<code>git tag v1.0.0 &amp;&amp; git push --tags</code>)</li>
<li><strong>Cross-compilation workflow</strong> builds platform-specific gems</li>
<li><strong>Publish gems</strong> to RubyGems or your private repository</li>
</ol>
<p>By following this workflow, you can be confident your extension works consistently across platforms.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="real-world-examples">Real-World Examples<a href="#real-world-examples" class="hash-link" aria-label="Direct link to Real-World Examples" title="Direct link to Real-World Examples">‚Äã</a></h2>
<p>Many real-world gems use rb-sys for cross-platform development:</p>
<ul>
<li><a href="https://github.com/oxidize-rb/blake3-ruby" target="_blank" rel="noopener noreferrer">blake3-ruby</a> - Fast cryptographic hash function implementation with full
cross-platform support</li>
<li><a href="https://github.com/yoshoku/lz4-ruby" target="_blank" rel="noopener noreferrer">lz4-ruby</a> - LZ4 compression library with rb-sys</li>
<li><a href="https://github.com/bytecodealliance/wasmtime-rb" target="_blank" rel="noopener noreferrer">wasmtime-rb</a> - WebAssembly runtime</li>
</ul>
<p>These projects demonstrate successful cross-platform strategies and can serve as references for your own extensions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-from-wasmtime-rb">Example from wasmtime-rb<a href="#example-from-wasmtime-rb" class="hash-link" aria-label="Direct link to Example from wasmtime-rb" title="Direct link to Example from wasmtime-rb">‚Äã</a></h3>
<p>wasmtime-rb wraps platform-specific functionality while presenting a consistent API:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">io</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(unix)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">unix</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">io</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">map_memory</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u8</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Unix-specific memory mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(windows)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mod</span><span class="token plain"> </span><span class="token module-declaration namespace" style="opacity:0.7">windows</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">io</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">map_memory</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u8</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Windows-specific memory mapping</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Public API uses the platform-specific implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">pub</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">map_memory</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u8</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(unix)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">return</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">unix</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_memory</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(windows)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">return</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">windows</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_memory</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">addr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(not(any(unix, windows)))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">return</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">ErrorKind</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Other</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Unsupported platform&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary">Summary<a href="#summary" class="hash-link" aria-label="Direct link to Summary" title="Direct link to Summary">‚Äã</a></h2>
<p>Cross-platform development with rb-sys leverages Rust&#x27;s excellent platform-specific features:</p>
<ol>
<li><strong>Conditional compilation</strong> provides platform-specific code paths</li>
<li><strong>Platform-specific dependencies</strong> allow different libraries per platform</li>
<li><strong>rb-sys-dock</strong> enables easy cross-compilation for multiple platforms</li>
<li><strong>GitHub Actions integration</strong> automates testing and releases</li>
</ol>
<p>By following the patterns in this chapter, your Ruby extensions can work seamlessly across all major platforms while
minimizing platform-specific code and maintenance burden.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next Steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next Steps" title="Direct link to Next Steps">‚Äã</a></h2>
<ul>
<li>Visit <a href="/docs/build-process">Build Process</a> to see local compilation details.</li>
<li>Check out <a href="/docs/testing">Testing Extensions</a> for CI workflows across platforms.</li>
<li>Use <a href="/docs/debugging">Debugging</a> techniques when cross-compiling fails.</li>
<li>Review <a href="/docs/project-setup">Project Setup</a> to organize multi-platform gems.</li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/oxidize-rb/rb-sys/tree/main/docsite/docs/cross-platform.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_VsjB"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-11-12T05:22:27.000Z" itemprop="dateModified">Nov 12, 2025</time></b> by <b>Xiaoxi Pang</b></span></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/troubleshooting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Troubleshooting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/api-reference/rb-sys-features"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">rb-sys Crate Features</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#supported-platforms" class="table-of-contents__link toc-highlight">Supported Platforms</a></li><li><a href="#platform-considerations" class="table-of-contents__link toc-highlight">Platform Considerations</a></li><li><a href="#understanding-platform-targets" class="table-of-contents__link toc-highlight">Understanding Platform Targets</a></li><li><a href="#conditional-compilation" class="table-of-contents__link toc-highlight">Conditional Compilation</a><ul><li><a href="#complete-example-file-path-handling" class="table-of-contents__link toc-highlight">Complete Example: File Path Handling</a></li></ul></li><li><a href="#platform-specific-dependencies" class="table-of-contents__link toc-highlight">Platform-Specific Dependencies</a></li><li><a href="#using-buildrs-for-platform-detection" class="table-of-contents__link toc-highlight">Using build.rs for Platform Detection</a></li><li><a href="#cross-compilation-with-rb-sys-dock" class="table-of-contents__link toc-highlight">Cross-Compilation with rb-sys-dock</a><ul><li><a href="#setting-up-rb-sys-dock-in-your-gem" class="table-of-contents__link toc-highlight">Setting Up rb-sys-dock in Your Gem</a></li><li><a href="#building-for-a-specific-platform" class="table-of-contents__link toc-highlight">Building for a Specific Platform</a></li><li><a href="#building-for-all-platforms" class="table-of-contents__link toc-highlight">Building for All Platforms</a></li><li><a href="#using-rb-sys-dock-directly" class="table-of-contents__link toc-highlight">Using rb-sys-dock Directly</a></li></ul></li><li><a href="#testing-cross-platform-builds" class="table-of-contents__link toc-highlight">Testing Cross-Platform Builds</a><ul><li><a href="#local-testing-with-docker" class="table-of-contents__link toc-highlight">Local Testing with Docker</a></li><li><a href="#local-testing-on-macos" class="table-of-contents__link toc-highlight">Local Testing on macOS</a></li></ul></li><li><a href="#cicd-for-multiple-platforms" class="table-of-contents__link toc-highlight">CI/CD for Multiple Platforms</a><ul><li><a href="#testing-on-multiple-platforms" class="table-of-contents__link toc-highlight">Testing on Multiple Platforms</a></li><li><a href="#ruby-head-compatibility" class="table-of-contents__link toc-highlight">Ruby-Head Compatibility</a></li><li><a href="#cross-compiling-for-release" class="table-of-contents__link toc-highlight">Cross-Compiling for Release</a></li><li><a href="#complete-ci-workflow-example" class="table-of-contents__link toc-highlight">Complete CI Workflow Example</a></li></ul></li><li><a href="#platform-specific-issues-and-solutions" class="table-of-contents__link toc-highlight">Platform-Specific Issues and Solutions</a><ul><li><a href="#windows" class="table-of-contents__link toc-highlight">Windows</a></li><li><a href="#macos" class="table-of-contents__link toc-highlight">macOS</a></li><li><a href="#linux" class="table-of-contents__link toc-highlight">Linux</a></li></ul></li><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best Practices</a><ul><li><a href="#example-good-platform-abstraction" class="table-of-contents__link toc-highlight">Example: Good Platform Abstraction</a></li></ul></li><li><a href="#complete-example-cross-platform-release-workflow" class="table-of-contents__link toc-highlight">Complete Example: Cross-Platform Release Workflow</a></li><li><a href="#real-world-examples" class="table-of-contents__link toc-highlight">Real-World Examples</a><ul><li><a href="#example-from-wasmtime-rb" class="table-of-contents__link toc-highlight">Example from wasmtime-rb</a></li></ul></li><li><a href="#summary" class="table-of-contents__link toc-highlight">Summary</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next Steps</a></li></ul></div></div></div></div></main></div></div></main></div><footer class="footer"><div class="footer__container"><div class="footer__links"><div class="col"><div class="footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li></ul></div></div><div class="col"><div class="footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/oxidize-rb/shared_invite/zt-16zv5tqte-Vi7WfzxCesdo2TqF_RYBCw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gvfU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/oxidize-rb/rb-sys/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gvfU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="col"><div class="footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/oxidize-rb/rb-sys" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gvfU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="col"><div class="footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"></ul></div></div></div><div class="footer__copyright">Copyright ¬© 2025 rb-sys</div></div></footer></div>
</body>
</html>