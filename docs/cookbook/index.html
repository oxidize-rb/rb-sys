<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-cookbook" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Cookbook | oxidize.rb</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://oxidize-rb.org/img/social-card.png"><meta data-rh="true" name="twitter:image" content="https://oxidize-rb.org/img/social-card.png"><meta data-rh="true" property="og:url" content="https://oxidize-rb.org/docs/cookbook"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cookbook | oxidize.rb"><meta data-rh="true" name="description" content="Ready-to-use recipes for common Ruby extension patterns with Rust."><meta data-rh="true" property="og:description" content="Ready-to-use recipes for common Ruby extension patterns with Rust."><meta data-rh="true" name="keywords" content="cookbook,recipes,examples,patterns,solutions"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://oxidize-rb.org/docs/cookbook"><link data-rh="true" rel="alternate" href="https://oxidize-rb.org/docs/cookbook" hreflang="en"><link data-rh="true" rel="alternate" href="https://oxidize-rb.org/docs/cookbook" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3a8f2e98.css">
<script src="/assets/js/runtime~main.51f19b32.js" defer="defer"></script>
<script src="/assets/js/main.bbfa9ded.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo-oxidize-rb.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" aria-label="oxidize.rb home page" href="/"><img src="/img/logo-oxidize-rb.svg" alt="oxidize.rb Logo" width="32" height="32"><span class="navbar__title">oxidize.rb</span></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/oxidize-rb/rb-sys" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div></nav><div class="main-wrapper mainWrapper_eExm"><main class="mainContent_VsED"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_mhZE"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Ruby + Rust = ❤️</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="true" href="/docs/getting-started">🚀 Getting Started</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/getting-started">Installation &amp; Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/quick-start">🚀 Quick Start (15 minutes)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/core-concepts">Core Concepts</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/project-setup">🔨 Building Extensions</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/memory-management">🧠 Memory &amp; Performance</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/examples">🌍 Real-World Patterns</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/testing">🧑‍💻 Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/cross-platform">📦 Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/api-reference/rb-sys-features">📖 Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/cookbook">📚 Resources</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/cookbook">Cookbook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/faq">Frequently Asked Questions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/community-support">Community and Support</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><div class="theme-doc-markdown markdown"><header><h1>Cookbook</h1></header>
<p>Ready-to-use recipes for common Ruby extension patterns. Copy, paste, and adapt!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="string-manipulation">String Manipulation<a href="#string-manipulation" class="hash-link" aria-label="Direct link to String Manipulation" title="Direct link to String Manipulation">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fast-string-reversal-with-unicode-support">Fast String Reversal with Unicode Support<a href="#fast-string-reversal-with-unicode-support" class="hash-link" aria-label="Direct link to Fast String Reversal with Unicode Support" title="Direct link to Fast String Reversal with Unicode Support">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain">function</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">prelude</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">unicode_segmentation</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">UnicodeSegmentation</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">reverse_preserving_graphemes</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    input</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">graphemes</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token boolean" style="color:hsl(5, 65%, 75%)">true</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">rev</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">collect</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[magnus::init]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">init</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token class-name">Ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> module </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">define_module</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;StringUtils&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    module</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">define_singleton_method</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;reverse_unicode&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">function!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">reverse_preserving_graphemes</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token number" style="color:hsl(5, 65%, 75%)">1</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><strong>Usage:</strong></p>
<div class="language-ruby codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-ruby codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">StringUtils</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">reverse_unicode</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string-literal string" style="color:hsl(28, 60%, 70%)">&quot;Hello 👨‍👩‍👧‍👦!&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic"># =&gt; &quot;!👨‍👩‍👧‍👦 olleH&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="efficient-string-search-and-replace">Efficient String Search and Replace<a href="#efficient-string-search-and-replace" class="hash-link" aria-label="Direct link to Efficient String Search and Replace" title="Direct link to Efficient String Search and Replace">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">regex</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Regex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">batch_replace</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">text</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> patterns</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">pattern</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> replacement</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> patterns </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> re </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Regex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">pattern</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">arg_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Invalid regex: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> re</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">replace_all</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> replacement</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_str</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">to_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-processing">Data Processing<a href="#data-processing" class="hash-link" aria-label="Direct link to Data Processing" title="Direct link to Data Processing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="parallel-array-processing">Parallel Array Processing<a href="#parallel-array-processing" class="hash-link" aria-label="Direct link to Parallel Array Processing" title="Direct link to Parallel Array Processing">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">rayon</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">prelude</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">rb_sys</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">rb_thread_call_without_gvl</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">parallel_map</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Convert to Rust Vec</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> items </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">with_capacity</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> item </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">each</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> item</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">try_convert</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        items</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Process in parallel (release GVL)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> processed </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token function" style="color:hsl(5, 65%, 65%)">rb_thread_call_without_gvl</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">data</span><span class="token closure-params punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token closure-params"> </span><span class="token closure-params operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token closure-params keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token closure-params"> </span><span class="token closure-params class-name">Vec</span><span class="token closure-params operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token closure-params keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token closure-params operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> items </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                items</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">par_iter</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token closure-params">x</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> x </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token plain"> x</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain">  </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Square each number</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">collect</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Vec</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token plain">_</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> items </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">as</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> _ </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">as</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> _</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token class-name">None</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">ptr</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">null_mut</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Convert back to Ruby array</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> val </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> processed </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="csv-processing">CSV Processing<a href="#csv-processing" class="hash-link" aria-label="Direct link to CSV Processing" title="Direct link to CSV Processing">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">RHash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Symbol</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> csv</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">parse_csv_to_hashes</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">csv_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> reader </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">csv</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Reader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from_reader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">csv_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_bytes</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> headers </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> reader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">headers</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">to_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">clone</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> record </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> reader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">records</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> record </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> record</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">to_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> hash </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">RHash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">header</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> headers</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">iter</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">zip</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">record</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">iter</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            hash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">aset</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Symbol</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">header</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">hash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="json-handling">JSON Handling<a href="#json-handling" class="hash-link" aria-label="Direct link to JSON Handling" title="Direct link to JSON Handling">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="high-performance-json-parser">High-Performance JSON Parser<a href="#high-performance-json-parser" class="hash-link" aria-label="Direct link to High-Performance JSON Parser" title="Direct link to High-Performance JSON Parser">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RHash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> serde_json</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">parse_json</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">json_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde_json</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Value</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde_json</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from_str</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">json_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;JSON parse error: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token function" style="color:hsl(5, 65%, 65%)">json_to_ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">json_to_ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde_json</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">serde_json</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Value</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">as</span><span class="token plain"> </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">match</span><span class="token plain"> value </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Null</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token constant" style="color:hsl(5, 65%, 75%)">QNIL</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Bool</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Number</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">n</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> n</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">else</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> n</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_f64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token class-name">Err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                    </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                    </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Number out of range&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">s</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> ruby_array </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">with_capacity</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> item </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> arr </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                ruby_array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token function" style="color:hsl(5, 65%, 65%)">json_to_ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">item</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">ruby_array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">into</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">J</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Object</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">obj</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> ruby_hash </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">RHash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> obj </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                ruby_hash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">aset</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">key</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token function" style="color:hsl(5, 65%, 65%)">json_to_ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">ruby_hash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">into</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="file-operations">File Operations<a href="#file-operations" class="hash-link" aria-label="Direct link to File Operations" title="Direct link to File Operations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="fast-file-processing">Fast File Processing<a href="#fast-file-processing" class="hash-link" aria-label="Direct link to Fast File Processing" title="Direct link to Fast File Processing">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">fs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">io</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">BufRead</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">BufReader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">process_large_file</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> file </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">File</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">open</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Cannot open file: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> reader </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">BufReader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">file</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> count </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token number" style="color:hsl(5, 65%, 75%)">0i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> line </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> reader</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">lines</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> line </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> line</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Read error: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> line</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">contains</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">pattern</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            count </span><span class="token operator" style="color:hsl(220, 10%, 65%)">+=</span><span class="token plain"> </span><span class="token number" style="color:hsl(5, 65%, 75%)">1</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">count</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">read_binary_file</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> data </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">read</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">path</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Cannot read file: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Return as binary string</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from_slice</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="cryptography">Cryptography<a href="#cryptography" class="hash-link" aria-label="Direct link to Cryptography" title="Direct link to Cryptography">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hash-functions">Hash Functions<a href="#hash-functions" class="hash-link" aria-label="Direct link to Hash Functions" title="Direct link to Hash Functions">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">sha2</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">Sha256</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Digest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> hex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">sha256_hexdigest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> data </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> input</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_slice</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> hasher </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Sha256</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    hasher</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">update</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> hasher</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">finalize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token namespace" style="opacity:0.7">hex</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">encode</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">sha256_raw</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">input</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> data </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> input</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_slice</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> hasher </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Sha256</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    hasher</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">update</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> hasher</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">finalize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from_slice</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="database-operations">Database Operations<a href="#database-operations" class="hash-link" aria-label="Direct link to Database Operations" title="Direct link to Database Operations">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="connection-pool-pattern">Connection Pool Pattern<a href="#connection-pool-pattern" class="hash-link" aria-label="Direct link to Connection Pool Pattern" title="Direct link to Connection Pool Pattern">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain">class</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> define_class</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">sync</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">Arc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Mutex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">once_cell</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">sync</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Lazy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Global connection pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">static</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">POOL</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Lazy</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Arc</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Mutex</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Vec</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Connection</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;&gt;</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Lazy</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Arc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Mutex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Vec</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">struct</span><span class="token plain"> </span><span class="token type-definition class-name">Connection</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    id</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Your actual connection here</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[magnus::wrap(class = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;DatabasePool&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, free_immediately)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">struct</span><span class="token plain"> </span><span class="token type-definition class-name">DatabasePool</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">impl</span><span class="token plain"> </span><span class="token class-name">DatabasePool</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">acquire</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Connection</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> pool </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">POOL</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">lock</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">if</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token class-name">Some</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> pool</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">pop</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">else</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Create new connection</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Connection</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> id</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> pool</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">len</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">release</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Connection</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> pool </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token constant" style="color:hsl(5, 65%, 75%)">POOL</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">lock</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        pool</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">with_connection</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">F</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">R</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">F</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">R</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">F</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">FnOnce</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token class-name">Connection</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">R</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> conn </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">Self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">acquire</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(5, 65%, 65%)">f</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">conn</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">Self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">release</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">conn</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        result</span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="http-client">HTTP Client<a href="#http-client" class="hash-link" aria-label="Direct link to HTTP Client" title="Direct link to HTTP Client">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="async-http-requests">Async HTTP Requests<a href="#async-http-requests" class="hash-link" aria-label="Direct link to Async HTTP Requests" title="Direct link to Async HTTP Requests">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RHash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> reqwest</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">tokio</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">runtime</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Runtime</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">fetch_json</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">url</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">String</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RHash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> rt </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Runtime</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> response </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> rt</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">block_on</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">async</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token namespace" style="opacity:0.7">reqwest</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">get</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">url</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;HTTP request failed: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">json</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token namespace" style="opacity:0.7">serde_json</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Value</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">await</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">                </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;JSON parse failed: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Convert JSON to Ruby hash</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">match</span><span class="token plain"> </span><span class="token function" style="color:hsl(5, 65%, 65%)">json_to_ruby</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">response</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Hash</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">h</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">h</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        _ </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=&gt;</span><span class="token plain"> </span><span class="token class-name">Err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Response was not a JSON object&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="image-processing">Image Processing<a href="#image-processing" class="hash-link" aria-label="Direct link to Image Processing" title="Direct link to Image Processing">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="basic-image-operations">Basic Image Operations<a href="#basic-image-operations" class="hash-link" aria-label="Direct link to Basic Image Operations" title="Direct link to Basic Image Operations">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">image</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">DynamicImage</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">ImageFormat</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">resize_image</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    image_data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    width</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u32</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    height</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">u32</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> bytes </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">unsafe</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"> image_data</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_slice</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> img </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">image</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">load_from_memory</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">bytes</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Invalid image: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> resized </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> img</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">resize_exact</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">width</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> height</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">image</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">imageops</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">FilterType</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Lanczos3</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> output </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    resized</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">write_to</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> output</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">ImageFormat</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Png</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">map_err</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token closure-params">e</span><span class="token closure-params closure-punctuation punctuation" style="color:hsl(220, 10%, 65%)">|</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">exception</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">runtime_error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token macro property" style="color:hsl(5, 65%, 75%)">format!</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;Failed to encode image: {}&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> e</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">RString</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">from_slice</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token plain">output</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="performance-monitoring">Performance Monitoring<a href="#performance-monitoring" class="hash-link" aria-label="Direct link to Performance Monitoring" title="Direct link to Performance Monitoring">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="benchmarking-helper">Benchmarking Helper<a href="#benchmarking-helper" class="hash-link" aria-label="Direct link to Benchmarking Helper" title="Direct link to Benchmarking Helper">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token namespace" style="opacity:0.7">block</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Proc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">time</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Instant</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">benchmark_block</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">iterations</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> block</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Proc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">f64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> start </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">Instant</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">now</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">for</span><span class="token plain"> _ </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">in</span><span class="token plain"> </span><span class="token number" style="color:hsl(5, 65%, 75%)">0</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">..</span><span class="token plain">iterations </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        block</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">call</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token plain">_</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> duration </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> start</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">elapsed</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">duration</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">as_secs_f64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">measure_memory</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">F</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">R</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">f</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">F</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">R</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">where</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">F</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">FnOnce</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">R</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> before </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(5, 65%, 65%)">get_memory_usage</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> result </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(5, 65%, 65%)">f</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> after </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token function" style="color:hsl(5, 65%, 65%)">get_memory_usage</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">result</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> after </span><span class="token operator" style="color:hsl(220, 10%, 65%)">-</span><span class="token plain"> before</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">get_memory_usage</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">usize</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Platform-specific memory measurement</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;linux&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token plain">fs</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> status </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">fs</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">read_to_string</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token string" style="color:hsl(28, 60%, 70%)">&quot;/proc/self/status&quot;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Parse VmRSS from status</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token number" style="color:hsl(5, 65%, 75%)">0</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Placeholder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[cfg(not(target_os = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;linux&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">))]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token number" style="color:hsl(5, 65%, 75%)">0</span><span class="token plain"> </span><span class="token comment" style="color:hsl(220, 10%, 50%);font-style:italic">// Placeholder</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="thread-safety">Thread Safety<a href="#thread-safety" class="hash-link" aria-label="Direct link to Thread Safety" title="Direct link to Thread Safety">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="thread-safe-counter">Thread-Safe Counter<a href="#thread-safe-counter" class="hash-link" aria-label="Direct link to Thread-Safe Counter" title="Direct link to Thread-Safe Counter">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain">define_class</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> method</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">std</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token namespace" style="opacity:0.7">sync</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token class-name">Arc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Mutex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[magnus::wrap(class = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;ThreadSafeCounter&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, free_immediately)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">struct</span><span class="token plain"> </span><span class="token type-definition class-name">ThreadSafeCounter</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Arc</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">Mutex</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">impl</span><span class="token plain"> </span><span class="token class-name">ThreadSafeCounter</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">ThreadSafeCounter</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Arc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token class-name">Mutex</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token number" style="color:hsl(5, 65%, 75%)">0</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">increment</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> val </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">lock</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token plain">val </span><span class="token operator" style="color:hsl(220, 10%, 65%)">+=</span><span class="token plain"> </span><span class="token number" style="color:hsl(5, 65%, 75%)">1</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> val </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">lock</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">*</span><span class="token plain">val</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-iterators">Custom Iterators<a href="#custom-iterators" class="hash-link" aria-label="Direct link to Custom Iterators" title="Direct link to Custom Iterators">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="ruby-style-enumerator">Ruby-Style Enumerator<a href="#ruby-style-enumerator" class="hash-link" aria-label="Direct link to Ruby-Style Enumerator" title="Direct link to Ruby-Style Enumerator">​</a></h3>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:hsl(35, 15%, 88%);--prism-background-color:hsl(220, 18%, 10%)"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:hsl(35, 15%, 88%);background-color:hsl(220, 18%, 10%)"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token keyword" style="color:hsl(200, 85%, 65%)">use</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">magnus</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain">class</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token namespace" style="opacity:0.7">block</span><span class="token namespace punctuation" style="opacity:0.7;color:hsl(220, 10%, 65%)">::</span><span class="token class-name">Proc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">#[magnus::wrap(class = </span><span class="token attribute attr-name string" style="color:hsl(28, 60%, 70%)">&quot;RangeIterator&quot;</span><span class="token attribute attr-name" style="color:hsl(200, 85%, 70%)">, free_immediately)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">struct</span><span class="token plain"> </span><span class="token type-definition class-name">RangeIterator</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    current</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    end</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    step</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token keyword" style="color:hsl(200, 85%, 65%)">impl</span><span class="token plain"> </span><span class="token class-name">RangeIterator</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">start</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> end</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> step</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Option</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">i64</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">Self</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">RangeIterator</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            current</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> start</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            end</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            step</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> step</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">unwrap_or</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token number" style="color:hsl(5, 65%, 75%)">1</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">each</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> block</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">:</span><span class="token plain"> </span><span class="token class-name">Proc</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">while</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">current </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">end </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            block</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">call</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token plain">_</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> _</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Value</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">current</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">current </span><span class="token operator" style="color:hsl(220, 10%, 65%)">+=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">step</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:hsl(5, 65%, 65%)">to_a</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&amp;</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">mut</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">-&gt;</span><span class="token plain"> </span><span class="token class-name">Result</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">,</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token operator" style="color:hsl(220, 10%, 65%)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">let</span><span class="token plain"> array </span><span class="token operator" style="color:hsl(220, 10%, 65%)">=</span><span class="token plain"> </span><span class="token class-name">RArray</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">::</span><span class="token function" style="color:hsl(5, 65%, 65%)">new</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">while</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">current </span><span class="token operator" style="color:hsl(220, 10%, 65%)">&lt;</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">end </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token function" style="color:hsl(5, 65%, 65%)">push</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">current</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token operator" style="color:hsl(220, 10%, 65%)">?</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">            </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">current </span><span class="token operator" style="color:hsl(220, 10%, 65%)">+=</span><span class="token plain"> </span><span class="token keyword" style="color:hsl(200, 85%, 65%)">self</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">.</span><span class="token plain">step</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">        </span><span class="token class-name">Ok</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">(</span><span class="token plain">array</span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain">    </span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:hsl(35, 15%, 88%)"><span class="token plain"></span><span class="token punctuation" style="color:hsl(220, 10%, 65%)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<hr>
<div class="success-message"><h3 class="anchor anchorWithStickyNavbar_LWe7" id="-more-recipes-coming">🍳 More Recipes Coming!<a href="#-more-recipes-coming" class="hash-link" aria-label="Direct link to 🍳 More Recipes Coming!" title="Direct link to 🍳 More Recipes Coming!">​</a></h3><p>Have a pattern you&#x27;d like to see? <a href="https://github.com/oxidize-rb/rb-sys/issues" target="_blank" rel="noopener noreferrer">Open an issue</a> or contribute your own!</p></div></div></article></div></div></div></div></main></div></div></main></div><footer class="footer"><div class="footer__container"><div class="footer__links"><div class="col"><div class="footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started">Getting Started</a></li></ul></div></div><div class="col"><div class="footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/oxidize-rb/shared_invite/zt-16zv5tqte-Vi7WfzxCesdo2TqF_RYBCw" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gvfU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/oxidize-rb/rb-sys/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Issues<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gvfU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="col"><div class="footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/oxidize-rb/rb-sys" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_gvfU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="col"><div class="footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"></ul></div></div></div><div class="footer__copyright">Copyright © 2025 rb-sys</div></div></footer></div>
</body>
</html>