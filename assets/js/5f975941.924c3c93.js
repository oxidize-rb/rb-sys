"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[233],{933:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"api-reference/rb-sys-features","title":"Crate `rb-sys`","description":"The rb-sys crate provides low-level Rust bindings for the Ruby C API, generated directly from ruby.h headers.","source":"@site/docs/api-reference/rb-sys-features.mdx","sourceDirName":"api-reference","slug":"/api-reference/rb-sys-features","permalink":"/docs/api-reference/rb-sys-features","draft":false,"unlisted":false,"editUrl":"https://github.com/oxidize-rb/rb-sys/tree/main/docsite/docs/api-reference/rb-sys-features.mdx","tags":[],"version":"current","lastUpdatedBy":"Ian Ker-Seymer","lastUpdatedAt":1765754018000,"frontMatter":{"id":"rb-sys-features","title":"Crate `rb-sys`"},"sidebar":"docsSidebar","previous":{"title":"Deployment & Distribution","permalink":"/docs/deployment"},"next":{"title":"Gem Configuration","permalink":"/docs/api-reference/rb-sys-gem-config"}}');var r=s(4848),i=s(8453);const l={id:"rb-sys-features",title:"Crate `rb-sys`"},d="Crate rb-sys",c={},a=[{value:"Constraints",id:"constraints",level:2},{value:"Crate Features",id:"crate-features",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Ruby Gem Integration",id:"ruby-gem-integration",level:3},{value:"Embedding Ruby VM",id:"embedding-ruby-vm",level:3},{value:"Ruby Version Compatibility",id:"ruby-version-compatibility",level:2},{value:"Integration with Magnus",id:"integration-with-magnus",level:2}];function o(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsxs)(t.h1,{id:"crate-rb-sys",children:["Crate ",(0,r.jsx)(t.code,{children:"rb-sys"})]})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"rb-sys"})," crate provides low-level Rust bindings for the Ruby C API, generated directly from ",(0,r.jsx)(t.code,{children:"ruby.h"})," headers."]}),"\n",(0,r.jsx)(t.h2,{id:"constraints",children:"Constraints"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsxs)(t.strong,{children:["Direct ",(0,r.jsx)(t.code,{children:"rb-sys"}),":"]})," Use for raw, ",(0,r.jsx)(t.code,{children:"unsafe"})," access to ",(0,r.jsx)(t.code,{children:"libruby"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Gem Development:"})," For most gem development, prefer higher-level libraries (e.g., ",(0,r.jsx)(t.a,{href:"https://github.com/matsadler/magnus",children:"Magnus"})," with ",(0,r.jsx)(t.code,{children:"rb-sys"})," feature). See ",(0,r.jsx)(t.a,{href:"/docs/development-approaches",children:"Development Approaches"}),"."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Embedding Ruby:"})," Use ",(0,r.jsx)(t.code,{children:"rb-sys"})," with the ",(0,r.jsx)(t.code,{children:"link-ruby"})," feature."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"crate-features",children:"Crate Features"}),"\n",(0,r.jsxs)(t.p,{children:["The following features can be enabled in your ",(0,r.jsx)(t.code,{children:"Cargo.toml"}),"."]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Feature"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Description"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Default"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"gem"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Configures the crate for building a Ruby gem (e.g., does not link ",(0,r.jsx)(t.code,{children:"libruby"}),")."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"\u2705"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"link-ruby"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Links ",(0,r.jsx)(t.code,{children:"libruby"})," for embedding the Ruby VM in a Rust binary."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"ruby-static"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["Statically links ",(0,r.jsx)(t.code,{children:"libruby"}),". Can also be set with the ",(0,r.jsx)(t.code,{children:"RUBY_STATIC=true"})," env var."]}),(0,r.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"global-allocator"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Reports Rust memory allocations to the Ruby GC. Recommended for gems."}),(0,r.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"stable-api"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Uses Ruby's C-level stable API if available for your Ruby version."}),(0,r.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"bindgen-rbimpls"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Includes internal Ruby implementation types in the generated bindings."}),(0,r.jsx)(t.td,{style:{textAlign:"left"}})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.code,{children:"bindgen-deprecated-types"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"Includes deprecated Ruby functions and types in the bindings."}),(0,r.jsx)(t.td,{style:{textAlign:"left"}})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,r.jsx)(t.h3,{id:"ruby-gem-integration",children:"Ruby Gem Integration"}),"\n",(0,r.jsxs)(t.p,{children:["Enable the ",(0,r.jsx)(t.code,{children:"gem"})," feature (default) and ",(0,r.jsx)(t.code,{children:"global-allocator"})," for memory reporting."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:'[dependencies]\nrb-sys = { version = "0.9", features = ["global-allocator"] }\n'})}),"\n",(0,r.jsx)(t.h3,{id:"embedding-ruby-vm",children:"Embedding Ruby VM"}),"\n",(0,r.jsxs)(t.p,{children:["Enable the ",(0,r.jsx)(t.code,{children:"link-ruby"})," feature to embed a Ruby VM."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:'[dependencies]\nrb-sys = { version = "0.9", features = ["link-ruby"] }\n'})}),"\n",(0,r.jsx)(t.h2,{id:"ruby-version-compatibility",children:"Ruby Version Compatibility"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"rb-sys"})," is compatible with Ruby 2.7 and later. The crate detects the Ruby version at compile time and adapts the\nbindings accordingly."]}),"\n",(0,r.jsxs)(t.p,{children:["For Ruby 3.2 and later, ",(0,r.jsx)(t.code,{children:"rb-sys"})," provides a ",(0,r.jsx)(t.code,{children:"ruby_abi_version"})," function that is required for native extensions."]}),"\n",(0,r.jsx)(t.h2,{id:"integration-with-magnus",children:"Integration with Magnus"}),"\n",(0,r.jsxs)(t.p,{children:["If you're building a Ruby extension, it's recommended to use the ",(0,r.jsx)(t.a,{href:"https://github.com/matsadler/magnus",children:"Magnus"})," crate on\ntop of ",(0,r.jsx)(t.code,{children:"rb-sys"}),". Magnus provides a high-level, safe API for interacting with Ruby:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-toml",children:'[dependencies]\nmagnus = { version = "0.7", features = ["rb-sys"] }\nrb-sys = "0.9"\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>d});var n=s(6540);const r={},i=n.createContext(r);function l(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);