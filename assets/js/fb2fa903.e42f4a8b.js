"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[4118],{4152:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"api-reference/rb-sys-gem-config","title":"Gem Configuration","description":"The rb_sys Ruby gem provides helpers for building Rust-based extensions, integrating with standard tools like rake-compiler.","source":"@site/docs/api-reference/rb-sys-gem-config.mdx","sourceDirName":"api-reference","slug":"/api-reference/rb-sys-gem-config","permalink":"/docs/api-reference/rb-sys-gem-config","draft":false,"unlisted":false,"editUrl":"https://github.com/oxidize-rb/rb-sys/tree/main/docsite/docs/api-reference/rb-sys-gem-config.mdx","tags":[],"version":"current","lastUpdatedBy":"Ian Ker-Seymer","lastUpdatedAt":1764873015000,"frontMatter":{"id":"rb-sys-gem-config","title":"Gem Configuration"},"sidebar":"docsSidebar","previous":{"title":"Crate `rb-sys`","permalink":"/docs/api-reference/rb-sys-features"},"next":{"title":"Testing with `rb-sys-test-helpers`","permalink":"/docs/api-reference/test-helpers"}}');var s=n(4848),i=n(8453);const l={id:"rb-sys-gem-config",title:"Gem Configuration"},o="Gem Configuration",c={},d=[{value:"<code>RbSys::ExtensionTask</code>",id:"rbsysextensiontask",level:2},{value:"<code>create_rust_makefile</code>",id:"create_rust_makefile",level:2},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"<code>libclang</code> Not Found",id:"libclang-not-found",level:3}];function a(e){const t={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"gem-configuration",children:"Gem Configuration"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"rb_sys"})," Ruby gem provides helpers for building Rust-based extensions, integrating with standard tools like ",(0,s.jsx)(t.code,{children:"rake-compiler"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"rbsysextensiontask",children:(0,s.jsx)(t.code,{children:"RbSys::ExtensionTask"})}),"\n",(0,s.jsxs)(t.p,{children:["Define how your Rust extension is built within your ",(0,s.jsx)(t.code,{children:"Rakefile"})," using ",(0,s.jsx)(t.code,{children:"RbSys::ExtensionTask"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ruby",children:'# Rakefile\nrequire "rb_sys/extensiontask"\n\nGEMSPEC = Gem::Specification.load("my_gem.gemspec")\n\nRbSys::ExtensionTask.new("my-crate-name", GEMSPEC) do |ext|\n  ext.lib_dir = "lib/my_gem"\n  ext.cross_compile = true # Enable cross-compilation with rb-sys-dock.\nend\n'})}),"\n",(0,s.jsx)(t.h2,{id:"create_rust_makefile",children:(0,s.jsx)(t.code,{children:"create_rust_makefile"})}),"\n",(0,s.jsxs)(t.p,{children:["Generate a Ruby-compatible ",(0,s.jsx)(t.code,{children:"Makefile"})," for your Rust extension in your ",(0,s.jsx)(t.code,{children:"extconf.rb"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ruby",children:'# ext/my_gem/extconf.rb\nrequire "mkmf"\nrequire "rb_sys/mkmf"\n\ncreate_rust_makefile("my_gem") do |r|\n  r.profile = ENV.fetch("RB_SYS_CARGO_PROFILE", :dev).to_sym # Cargo build profile (:dev or :release).\n  r.features = ["a-feature"] # Comma-separated list of Cargo features.\n  r.extra_rustflags = ["--cfg=some_config_flag"] # Extra flags for $RUSTFLAGS.\n  r.ext_dir = "." # Directory containing Cargo.toml, relative to extconf.rb.\nend\n'})}),"\n",(0,s.jsx)(t.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsxs)(t.p,{children:["These environment variables control the ",(0,s.jsx)(t.code,{children:"rb_sys"})," build process."]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Environment Variable"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"RB_SYS_CARGO_PROFILE"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Set the Cargo profile (e.g., ",(0,s.jsx)(t.code,{children:"release"})," or ",(0,s.jsx)(t.code,{children:"dev"}),")."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"RB_SYS_CARGO_FEATURES"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Comma-separated list of Cargo features to enable."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"RB_SYS_FORCE_INSTALL_RUST_TOOLCHAIN"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Set to ",(0,s.jsx)(t.code,{children:"true"})," to force installation of a Rust toolchain."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"RUBY_STATIC"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Set to ",(0,s.jsx)(t.code,{children:"true"})," to force static linking of ",(0,s.jsx)(t.code,{children:"libruby"}),"."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"LIBCLANG_PATH"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Path to ",(0,s.jsx)(t.code,{children:"libclang"})," if it can't be found automatically."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.code,{children:"RB_SYS_VERBOSE_BUILD"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Set to ",(0,s.jsx)(t.code,{children:"true"})," to enable verbose output during the build."]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsxs)(t.h3,{id:"libclang-not-found",children:[(0,s.jsx)(t.code,{children:"libclang"})," Not Found"]}),"\n",(0,s.jsxs)(t.p,{children:["If ",(0,s.jsx)(t.code,{children:"libclang"})," is not found during ",(0,s.jsx)(t.code,{children:"bindgen"})," execution, add the ",(0,s.jsx)(t.code,{children:"libclang"})," gem to your ",(0,s.jsx)(t.code,{children:"Gemfile"}),"."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ruby",children:'# Gemfile\ngem "libclang", "~> 14.0.6"\n'})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var r=n(6540);const s={},i=r.createContext(s);function l(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);