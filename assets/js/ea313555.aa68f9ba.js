"use strict";(self.webpackChunkdocsite=self.webpackChunkdocsite||[]).push([[1011],{6280:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"faq","title":"Frequently Asked Questions","description":"Answers to common questions about building Ruby extensions with Rust.","source":"@site/docs/faq.mdx","sourceDirName":".","slug":"/faq","permalink":"/docs/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/oxidize-rb/rb-sys/tree/main/docsite/docs/faq.mdx","tags":[],"version":"current","lastUpdatedBy":"Ian Ker-Seymer","lastUpdatedAt":1764825964000,"frontMatter":{"id":"faq","title":"Frequently Asked Questions"},"sidebar":"docsSidebar","previous":{"title":"Cookbook","permalink":"/docs/cookbook"},"next":{"title":"Glossary","permalink":"/docs/glossary"}}');var r=s(4848),o=s(8453);const t={id:"faq",title:"Frequently Asked Questions"},l="Frequently Asked Questions",d={},a=[{value:"General",id:"general",level:2},{value:"Q: When should I use Rust for a Ruby extension?",id:"q-when-should-i-use-rust-for-a-ruby-extension",level:3},{value:"Q: Is Rust harder to learn than C for writing gems?",id:"q-is-rust-harder-to-learn-than-c-for-writing-gems",level:3},{value:"Q: Will my code be faster?",id:"q-will-my-code-be-faster",level:3},{value:"Q: Will a Rust extension work with Rails?",id:"q-will-a-rust-extension-work-with-rails",level:3},{value:"Technical",id:"technical",level:2},{value:"Q: How do I debug my extension?",id:"q-how-do-i-debug-my-extension",level:3},{value:"Q: How do I distribute my gem to users?",id:"q-how-do-i-distribute-my-gem-to-users",level:3},{value:"Q: How do I handle panics?",id:"q-how-do-i-handle-panics",level:3},{value:"Q: Why is my extension slower than I expected?",id:"q-why-is-my-extension-slower-than-i-expected",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Q: I&#39;m getting &quot;undefined symbol&quot; errors.",id:"q-im-getting-undefined-symbol-errors",level:3},{value:"Q: The build is failing with a &quot;libclang not found&quot; error.",id:"q-the-build-is-failing-with-a-libclang-not-found-error",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"frequently-asked-questions",children:"Frequently Asked Questions"})}),"\n",(0,r.jsx)(n.p,{children:"Answers to common questions about building Ruby extensions with Rust."}),"\n",(0,r.jsx)(n.h2,{id:"general",children:"General"}),"\n",(0,r.jsx)(n.h3,{id:"q-when-should-i-use-rust-for-a-ruby-extension",children:"Q: When should I use Rust for a Ruby extension?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Use Rust for CPU-bound, memory-intensive, or security-sensitive tasks, or for wrapping existing Rust libraries. See ",(0,r.jsx)(n.a,{href:"/docs/development-approaches",children:"Development Approaches"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"q-is-rust-harder-to-learn-than-c-for-writing-gems",children:"Q: Is Rust harder to learn than C for writing gems?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Rust has a steeper initial learning curve due to ownership rules, but its compiler prevents bugs common in C extensions."]}),"\n",(0,r.jsx)(n.h3,{id:"q-will-my-code-be-faster",children:"Q: Will my code be faster?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Rust extensions can be 10-100x faster for CPU-intensive tasks. However, FFI overhead can make simple operations slower. Always profile first. See ",(0,r.jsx)(n.a,{href:"/docs/performance",children:"Performance"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"q-will-a-rust-extension-work-with-rails",children:"Q: Will a Rust extension work with Rails?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Yes. A Rust-based gem functions like any other gem and can be used within a Rails application."]}),"\n",(0,r.jsx)(n.h2,{id:"technical",children:"Technical"}),"\n",(0,r.jsx)(n.h3,{id:"q-how-do-i-debug-my-extension",children:"Q: How do I debug my extension?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Compile with debug symbols and use ",(0,r.jsx)(n.code,{children:"gdb"})," or ",(0,r.jsx)(n.code,{children:"lldb"}),". See ",(0,r.jsx)(n.a,{href:"/docs/debugging",children:"Debugging"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"q-how-do-i-distribute-my-gem-to-users",children:"Q: How do I distribute my gem to users?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"}),' Ship pre-compiled ("fat") gems for common platforms to avoid requiring users to install Rust. See ',(0,r.jsx)(n.a,{href:"/docs/deployment",children:"Deployment & Distribution"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"q-how-do-i-handle-panics",children:"Q: How do I handle panics?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Avoid panics; they crash Ruby. Functions should return ",(0,r.jsx)(n.code,{children:"Result<T, magnus::Error>"})," to convert Rust errors into Ruby exceptions. See ",(0,r.jsx)(n.a,{href:"/docs/error-handling",children:"Error Handling"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"q-why-is-my-extension-slower-than-i-expected",children:"Q: Why is my extension slower than I expected?"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," There are common causes:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Too many conversions:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"use magnus::{Error, RArray, TryConvert};\n\n// Bad: Converts entire array upfront\nfn sum(numbers: Vec<i64>) -> i64 {\n    numbers.iter().sum()\n}\n\n// Good: Iterates without conversion\nfn sum_good(array: RArray) -> Result<i64, Error> {\n    let mut total = 0;\n    for item in array.each() {\n        total += i64::try_convert(item?)?;\n    }\n    Ok(total)\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Not releasing the GVL:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"fn release_gvl_example(data: &[u8]) {\n    // Release GVL for operations > 100ms\n    if data.len() > 1_000_000 {\n        // Use rb_thread_call_without_gvl\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"3. Excessive allocations:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rust",children:"fn excessive_allocations() {\n    // Bad: Allocates repeatedly\n    for i in 0..1000 {\n        let mut vec: Vec<i32> = Vec::new();\n        // ...\n    }\n\n    // Good: Reuse allocation\n    let mut vec: Vec<i32> = Vec::with_capacity(1000);\n    for i in 0..1000 {\n        vec.clear();\n        // ...\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"q-im-getting-undefined-symbol-errors",children:'Q: I\'m getting "undefined symbol" errors.'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," Ensure your Rust function is marked ",(0,r.jsx)(n.code,{children:"#[magnus::init]"})," or ",(0,r.jsx)(n.code,{children:'#[no_mangle] pub extern "C" fn Init_my_gem()'}),", ",(0,r.jsx)(n.code,{children:"crate-type"})," is ",(0,r.jsx)(n.code,{children:'["cdylib"]'}),", and names match ",(0,r.jsx)(n.code,{children:"extconf.rb"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"q-the-build-is-failing-with-a-libclang-not-found-error",children:'Q: The build is failing with a "libclang not found" error.'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"A:"})," ",(0,r.jsx)(n.code,{children:"rb-sys"})," uses ",(0,r.jsx)(n.code,{children:"bindgen"}),", which requires ",(0,r.jsx)(n.code,{children:"libclang"}),". Add ",(0,r.jsx)(n.code,{children:'gem "libclang"'})," to your ",(0,r.jsx)(n.code,{children:"Gemfile"}),", or install ",(0,r.jsx)(n.code,{children:"libclang"})," via your system package manager (e.g., ",(0,r.jsx)(n.code,{children:"brew install llvm"}),", ",(0,r.jsx)(n.code,{children:"apt-get install libclang-dev"}),")."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var i=s(6540);const r={},o=i.createContext(r);function t(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);